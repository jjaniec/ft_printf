language: c
sudo: true
before_install:
    - brew update || sudo apt-get update -yqq
    - brew install valgrind || sudo apt-get install -yqq valgrind
    - git clone https://github.com/jjaniec/libft.git
    - git clone https://github.com/yyang42/moulitest.git
    - cat moulitest/config.ini.template | tr '\n' '^' | sed "s#/absolute/path/to/project#$TRAVIS_BUILD_DIR#3" | tr '^' '\n' > moulitest/config.ini
    - curl http://ix.io/FDo > basic_tests.c
    - curl http://ix.io/FDI > leaks_tests.c
matrix:
    include:
        - os: osx
          compiler: gcc
          env: CXX=gcc
        - os: osx
          compiler: clang
          env: CXX=clang
        - os: linux
          compiler: gcc
          env: CXX=gcc
        - os: linux
          compiler: clang
          env: CXX=clang
    allow_failures:
        - os: linux
          compiler: gcc
          env: CXX=gcc
        - os: linux
          compiler: clang
          env: CXX=clang
script: make CC=$CXX re; gcc basic_tests.c libftprintf.a; ./a.out; make re C_FLAGS=-g; gcc leaks_tests.c libftprintf.a; valgrind --tool=memcheck --leak-check=yes --show-reachable=yes --num-callers=20 --track-fds=yes ./a.out; make -C moulitest ft_printf; make curqui_test
